{"version":3,"sources":["../src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { Command } from \"commander\";\nimport chalk from \"chalk\";\nimport ora from \"ora\";\nimport { GICMOrchestrator } from \"./orchestrator.js\";\nimport type { AutonomyLevel, OrchestratorConfig } from \"./types.js\";\n\nconst program = new Command();\n\nprogram\n  .name(\"gicm\")\n  .description(\"gICM Orchestrator - The Brain\")\n  .version(\"0.1.0\");\n\n// Global orchestrator instance\nlet orchestrator: GICMOrchestrator | null = null;\n\nfunction loadConfig(): OrchestratorConfig {\n  return {\n    autonomyLevel: (process.env.GICM_AUTONOMY_LEVEL as AutonomyLevel) ?? \"supervised\",\n    hunter: {\n      enabled: true,\n      sources: [\"github\", \"hackernews\", \"twitter\"],\n      githubToken: process.env.GITHUB_TOKEN,\n      apifyToken: process.env.APIFY_TOKEN,\n    },\n    decision: {\n      llmProvider: (process.env.LLM_PROVIDER as \"openai\" | \"anthropic\" | \"gemini\") ?? \"anthropic\",\n      apiKey: process.env.LLM_API_KEY ?? \"\",\n      model: process.env.LLM_MODEL,\n      autoApproveThreshold: 85,\n    },\n    activityLogger: {\n      solanaRpcUrl: process.env.SOLANA_RPC_URL,\n      solanaPrivateKey: process.env.SOLANA_PRIVATE_KEY,\n      enableArweave: !!process.env.SOLANA_PRIVATE_KEY,\n    },\n  };\n}\n\n// Start command\nprogram\n  .command(\"start\")\n  .description(\"Start the gICM orchestrator\")\n  .option(\"--auto\", \"Run in fully autonomous mode\", false)\n  .option(\"--supervised\", \"Run in supervised mode (default)\", true)\n  .option(\"--sources <sources>\", \"Hunt sources (comma-separated)\", \"github,hackernews,twitter\")\n  .action(async (options) => {\n    const config = loadConfig();\n\n    if (options.auto) {\n      config.autonomyLevel = \"autonomous\";\n    } else if (options.supervised) {\n      config.autonomyLevel = \"supervised\";\n    }\n\n    config.hunter.sources = options.sources.split(\",\") as typeof config.hunter.sources;\n\n    console.log(chalk.cyan(\"\\nðŸ§  gICM Orchestrator - The Brain\\n\"));\n    console.log(chalk.gray(`Autonomy Level: ${chalk.yellow(config.autonomyLevel)}`));\n    console.log(chalk.gray(`Hunt Sources: ${chalk.yellow(config.hunter.sources.join(\", \"))}`));\n    console.log(chalk.gray(`LLM Provider: ${chalk.yellow(config.decision.llmProvider)}`));\n    console.log();\n\n    if (!config.decision.apiKey) {\n      console.error(chalk.red(\"Error: LLM_API_KEY environment variable is required\"));\n      process.exit(1);\n    }\n\n    orchestrator = new GICMOrchestrator(config);\n\n    // Event handlers\n    orchestrator.on(\"started\", () => {\n      console.log(chalk.green(\"âœ“ Orchestrator started\"));\n    });\n\n    orchestrator.on(\"hunt:started\", () => {\n      console.log(chalk.blue(\"ðŸ” Hunt started...\"));\n    });\n\n    orchestrator.on(\"hunt:completed\", (discoveries: unknown[]) => {\n      console.log(chalk.green(`âœ“ Hunt completed: ${discoveries.length} discoveries`));\n    });\n\n    orchestrator.on(\"discovery:found\", (discovery: { title: string; source: string }) => {\n      console.log(chalk.cyan(`  â†’ Found: ${discovery.title} (${discovery.source})`));\n    });\n\n    orchestrator.on(\"decision:made\", ({ discovery, result, status }: {\n      discovery: { title: string };\n      result: { totalScore: number };\n      status: string;\n    }) => {\n      const statusColor =\n        status === \"auto_approve\"\n          ? chalk.green\n          : status === \"human_review\"\n            ? chalk.yellow\n            : chalk.red;\n      console.log(\n        `  â†’ Decision: ${discovery.title} - ${result.totalScore}/100 [${statusColor(status)}]`\n      );\n    });\n\n    orchestrator.on(\"approval:required\", (approval: { id: string; title: string; score: number }) => {\n      console.log(\n        chalk.yellow(`\\nâ³ Approval required: ${approval.title} (${approval.score}/100)`)\n      );\n      console.log(chalk.gray(`   Run: gicm approve ${approval.id}`));\n    });\n\n    try {\n      await orchestrator.start();\n      console.log(chalk.green(\"\\nâœ“ Orchestrator is running. Press Ctrl+C to stop.\\n\"));\n\n      // Handle shutdown\n      process.on(\"SIGINT\", async () => {\n        console.log(chalk.yellow(\"\\n\\nShutting down...\"));\n        await orchestrator?.stop();\n        process.exit(0);\n      });\n\n      // Keep process alive\n      await new Promise(() => {});\n    } catch (error) {\n      console.error(chalk.red(\"Failed to start orchestrator:\"), error);\n      process.exit(1);\n    }\n  });\n\n// Hunt command\nprogram\n  .command(\"hunt\")\n  .description(\"Trigger an immediate hunt for opportunities\")\n  .option(\"--sources <sources>\", \"Hunt sources (comma-separated)\", \"github,hackernews,twitter\")\n  .option(\"--limit <n>\", \"Max discoveries per source\", \"30\")\n  .action(async (options) => {\n    const config = loadConfig();\n    config.hunter.sources = options.sources.split(\",\") as typeof config.hunter.sources;\n\n    const spinner = ora(\"Initializing...\").start();\n\n    if (!config.decision.apiKey) {\n      spinner.fail(\"LLM_API_KEY environment variable is required\");\n      process.exit(1);\n    }\n\n    orchestrator = new GICMOrchestrator(config);\n\n    try {\n      spinner.text = \"Starting orchestrator...\";\n      await orchestrator.start();\n\n      spinner.text = `Hunting on ${config.hunter.sources.join(\", \")}...`;\n      const discoveries = await orchestrator.huntNow(config.hunter.sources);\n\n      spinner.succeed(`Found ${discoveries.length} discoveries`);\n\n      // Show results\n      if (discoveries.length > 0) {\n        console.log(chalk.cyan(\"\\nTop Discoveries:\"));\n        for (const d of discoveries.slice(0, 10)) {\n          console.log(\n            `  ${chalk.yellow(d.source)} | ${d.title.slice(0, 60)}...`\n          );\n          console.log(chalk.gray(`    ${d.sourceUrl}`));\n        }\n      }\n\n      // Show pending approvals\n      const approvals = orchestrator.getPendingApprovals();\n      if (approvals.length > 0) {\n        console.log(chalk.yellow(`\\n${approvals.length} items pending approval:`));\n        for (const a of approvals) {\n          console.log(`  ${chalk.cyan(a.id)} | ${a.title} (${a.score}/100)`);\n        }\n        console.log(chalk.gray(\"\\nRun: gicm approve <id> to approve\"));\n      }\n\n      await orchestrator.stop();\n    } catch (error) {\n      spinner.fail(\"Hunt failed\");\n      console.error(error);\n      process.exit(1);\n    }\n  });\n\n// Status command\nprogram\n  .command(\"status\")\n  .description(\"Show orchestrator status\")\n  .option(\"--json\", \"Output as JSON\")\n  .action(async (options) => {\n    const config = loadConfig();\n    orchestrator = new GICMOrchestrator(config);\n\n    const status = orchestrator.getStatus();\n\n    if (options.json) {\n      console.log(JSON.stringify(status, null, 2));\n    } else {\n      console.log(chalk.cyan(\"\\nðŸ§  gICM Orchestrator Status\\n\"));\n      console.log(`State: ${chalk.yellow(status.state)}`);\n      console.log(`Autonomy: ${chalk.yellow(status.autonomyLevel)}`);\n      console.log(`Pending Approvals: ${chalk.yellow(status.pendingApprovals)}`);\n      console.log(`Active Jobs: ${chalk.yellow(status.activeJobs.join(\", \") || \"none\")}`);\n\n      if (status.stats) {\n        console.log(chalk.cyan(\"\\nActivity Stats:\"));\n        console.log(`  Activities: ${status.stats.activities}`);\n        console.log(`  Discoveries: ${status.stats.discoveries}`);\n        console.log(`  Pending Decisions: ${status.stats.pendingDecisions}`);\n        console.log(\n          `  Sync Queue: Solana=${status.stats.syncQueue.solana}, Arweave=${status.stats.syncQueue.arweave}`\n        );\n      }\n    }\n  });\n\n// Approve command\nprogram\n  .command(\"approve <id>\")\n  .description(\"Approve a pending decision\")\n  .option(\"-r, --reason <reason>\", \"Approval reason\")\n  .option(\"--all\", \"Approve all pending decisions\")\n  .action(async (id, options) => {\n    const config = loadConfig();\n    orchestrator = new GICMOrchestrator(config);\n\n    // For --all, we'd need to load pending approvals from database\n    // For now, this is a placeholder\n\n    console.log(chalk.green(`âœ“ Approved: ${id}`));\n    if (options.reason) {\n      console.log(chalk.gray(`  Reason: ${options.reason}`));\n    }\n  });\n\n// Reject command\nprogram\n  .command(\"reject <id>\")\n  .description(\"Reject a pending decision\")\n  .option(\"-r, --reason <reason>\", \"Rejection reason\", \"Not relevant\")\n  .action(async (id, options) => {\n    console.log(chalk.red(`âœ— Rejected: ${id}`));\n    console.log(chalk.gray(`  Reason: ${options.reason}`));\n  });\n\n// Logs command\nprogram\n  .command(\"logs\")\n  .description(\"View activity logs\")\n  .option(\"--type <type>\", \"Filter by type (discovery, decision, build, deployment)\")\n  .option(\"--limit <n>\", \"Max logs to show\", \"20\")\n  .option(\"--since <date>\", \"Show logs since date\")\n  .option(\"--onchain\", \"Fetch from on-chain logs\")\n  .action(async (options) => {\n    console.log(chalk.cyan(\"\\nðŸ“‹ Activity Logs\\n\"));\n\n    // Placeholder - would read from SQLite database\n    console.log(chalk.gray(\"No logs available. Start the orchestrator first.\"));\n\n    if (options.type) {\n      console.log(chalk.gray(`Filter: type=${options.type}`));\n    }\n    if (options.since) {\n      console.log(chalk.gray(`Filter: since=${options.since}`));\n    }\n  });\n\nprogram.parse();\n"],"mappings":"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","names":[]}
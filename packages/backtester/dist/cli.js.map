{"version":3,"sources":["../src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { BacktestEngine } from \"./core/engine.js\";\nimport { CSVDataProvider } from \"./data/providers/csv.js\";\nimport { SMACrossoverStrategy, RSIStrategy } from \"./strategies/base.js\";\nimport type { BacktestResult } from \"./core/types.js\";\n\ninterface CLIArgs {\n  data?: string;\n  symbol: string;\n  strategy: string;\n  startDate: string;\n  endDate: string;\n  capital?: number;\n  output?: string;\n}\n\nfunction parseArgs(): CLIArgs {\n  const args = process.argv.slice(2);\n  const parsed: CLIArgs = {\n    symbol: \"BTC\",\n    strategy: \"sma\",\n    startDate: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0]!,\n    endDate: new Date().toISOString().split(\"T\")[0]!,\n  };\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    const value = args[i + 1];\n\n    switch (arg) {\n      case \"--data\":\n      case \"-d\":\n        parsed.data = value;\n        i++;\n        break;\n      case \"--symbol\":\n      case \"-s\":\n        parsed.symbol = value ?? parsed.symbol;\n        i++;\n        break;\n      case \"--strategy\":\n        parsed.strategy = value ?? parsed.strategy;\n        i++;\n        break;\n      case \"--start\":\n        parsed.startDate = value ?? parsed.startDate;\n        i++;\n        break;\n      case \"--end\":\n        parsed.endDate = value ?? parsed.endDate;\n        i++;\n        break;\n      case \"--capital\":\n      case \"-c\":\n        parsed.capital = parseInt(value ?? \"10000\");\n        i++;\n        break;\n      case \"--output\":\n      case \"-o\":\n        parsed.output = value;\n        i++;\n        break;\n      case \"--help\":\n      case \"-h\":\n        printHelp();\n        process.exit(0);\n    }\n  }\n\n  return parsed;\n}\n\nfunction printHelp(): void {\n  console.log(`\ngICM Backtester CLI\n\nUsage: gicm-backtest [options]\n\nOptions:\n  -d, --data <file>       CSV data file path\n  -s, --symbol <symbol>   Trading symbol (default: BTC)\n  --strategy <name>       Strategy: sma, rsi (default: sma)\n  --start <date>          Start date (YYYY-MM-DD)\n  --end <date>            End date (YYYY-MM-DD)\n  -c, --capital <amount>  Initial capital (default: 10000)\n  -o, --output <file>     Output file for results\n  -h, --help              Show this help\n\nExamples:\n  gicm-backtest -d btc.csv -s BTC --strategy sma --start 2023-01-01 --end 2024-01-01\n  gicm-backtest -d eth.csv -s ETH --strategy rsi --capital 50000\n`);\n}\n\nfunction formatResults(result: BacktestResult): string {\n  const metrics = result.metrics;\n\n  return `\n╔════════════════════════════════════════════════════════════════╗\n║                    BACKTEST RESULTS                            ║\n╠════════════════════════════════════════════════════════════════╣\n║ Period: ${result.startDate.toISOString().split(\"T\")[0]} to ${result.endDate.toISOString().split(\"T\")[0]}\n║ Initial Capital: $${result.initialCapital.toLocaleString()}\n║ Final Equity: $${result.finalEquity.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n╠════════════════════════════════════════════════════════════════╣\n║ RETURNS                                                         ║\n╠────────────────────────────────────────────────────────────────╣\n║ Total Return: ${(result.totalReturnPercent).toFixed(2)}%\n║ Annualized Return: ${(metrics.annualizedReturn * 100).toFixed(2)}%\n║ CAGR: ${(metrics.cagr * 100).toFixed(2)}%\n╠════════════════════════════════════════════════════════════════╣\n║ RISK                                                            ║\n╠────────────────────────────────────────────────────────────────╣\n║ Volatility: ${(metrics.volatility * 100).toFixed(2)}%\n║ Max Drawdown: ${(metrics.maxDrawdown * 100).toFixed(2)}%\n║ Sharpe Ratio: ${metrics.sharpeRatio.toFixed(2)}\n║ Sortino Ratio: ${metrics.sortinoRatio.toFixed(2)}\n║ Calmar Ratio: ${metrics.calmarRatio.toFixed(2)}\n╠════════════════════════════════════════════════════════════════╣\n║ TRADING                                                         ║\n╠────────────────────────────────────────────────────────────────╣\n║ Total Trades: ${metrics.totalTrades}\n║ Win Rate: ${(metrics.winRate * 100).toFixed(1)}%\n║ Profit Factor: ${metrics.profitFactor.toFixed(2)}\n║ Avg Win: $${metrics.avgWin.toFixed(2)}\n║ Avg Loss: $${metrics.avgLoss.toFixed(2)}\n║ Max Consecutive Wins: ${metrics.maxConsecutiveWins}\n║ Max Consecutive Losses: ${metrics.maxConsecutiveLosses}\n╚════════════════════════════════════════════════════════════════╝\n`;\n}\n\nasync function main(): Promise<void> {\n  const args = parseArgs();\n\n  console.log(\"gICM Backtester\");\n  console.log(\"===============\\n\");\n\n  // Initialize engine\n  const engine = new BacktestEngine({\n    initialCapital: args.capital ?? 10000,\n  });\n\n  // Set up data provider\n  const dataProvider = new CSVDataProvider();\n\n  if (args.data) {\n    // Load data from file (would need fs in real implementation)\n    console.log(`Loading data from ${args.data}...`);\n    // In browser/limited env, you'd pass data directly\n    console.log(\"Note: File loading requires Node.js fs module\");\n  } else {\n    console.log(\"No data file provided. Using demo data...\");\n    // Generate demo data\n    const demoData = generateDemoData(args.symbol);\n    await dataProvider.loadFromString(args.symbol, demoData);\n  }\n\n  engine.setDataProvider(dataProvider);\n\n  // Set up strategy\n  switch (args.strategy.toLowerCase()) {\n    case \"rsi\":\n      engine.setStrategy(new RSIStrategy({ symbol: args.symbol }));\n      console.log(\"Strategy: RSI (14 period, 30/70)\");\n      break;\n    case \"sma\":\n    default:\n      engine.setStrategy(new SMACrossoverStrategy({ symbol: args.symbol }));\n      console.log(\"Strategy: SMA Crossover (10/30)\");\n  }\n\n  console.log(`Symbol: ${args.symbol}`);\n  console.log(`Period: ${args.startDate} to ${args.endDate}\\n`);\n\n  // Run backtest\n  console.log(\"Running backtest...\\n\");\n\n  try {\n    const result = await engine.run({\n      startDate: new Date(args.startDate),\n      endDate: new Date(args.endDate),\n      symbols: [args.symbol],\n      interval: \"1d\",\n      warmupPeriod: 30,\n    });\n\n    console.log(formatResults(result));\n  } catch (error) {\n    console.error(\"Backtest failed:\", error);\n    process.exit(1);\n  }\n}\n\nfunction generateDemoData(symbol: string): string {\n  const lines = [\"date,open,high,low,close,volume\"];\n  let price = 100;\n\n  const startDate = new Date(\"2023-01-01\");\n  const endDate = new Date(\"2024-01-01\");\n\n  for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\n    // Random walk with some trend\n    const change = (Math.random() - 0.48) * 3; // Slight upward bias\n    price = Math.max(price + change, 10);\n\n    const open = price;\n    const high = price * (1 + Math.random() * 0.02);\n    const low = price * (1 - Math.random() * 0.02);\n    const close = low + Math.random() * (high - low);\n    const volume = Math.floor(1000000 + Math.random() * 5000000);\n\n    lines.push(\n      `${d.toISOString().split(\"T\")[0]},${open.toFixed(2)},${high.toFixed(2)},${low.toFixed(2)},${close.toFixed(2)},${volume}`\n    );\n  }\n\n  return lines.join(\"\\n\");\n}\n\nmain().catch(console.error);\n"],"mappings":"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","names":[]}